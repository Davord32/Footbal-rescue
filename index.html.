<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #1a472a; touch-action: none; font-family: 'Arial Black', sans-serif; }
        #menu { position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; text-align: center; }
        .flag-btn { padding: 10px 20px; margin: 5px; font-size: 18px; background: #34495e; color: white; border: 2px solid white; border-radius: 10px; }
        .start-btn { padding: 20px 60px; font-size: 28px; background: #2ecc71; border: none; border-radius: 50px; color: white; margin-top: 20px; box-shadow: 0 5px #1a6d3a; }
        #ui { position: absolute; top: 20px; width: 100%; display: none; justify-content: space-around; color: white; font-size: 20px; z-index: 10; pointer-events: none; }
    </style>
</head>
<body>
    <div id="menu">
        <h1 style="color:#f1c40f; font-size: 40px;">SOCCER RESCUE</h1>
        <p>Izaberi svoju drÅ¾avu:</p>
        <div>
            <button class="flag-btn" onclick="setFlag('ðŸ‡·ðŸ‡¸ SRB')">ðŸ‡·ðŸ‡¸ SRB</button>
            <button class="flag-btn" onclick="setFlag('ðŸ‡§ðŸ‡· BRA')">ðŸ‡§ðŸ‡· BRA</button>
            <button class="flag-btn" onclick="setFlag('ðŸ‡¦ðŸ‡· ARG')">ðŸ‡¦ðŸ‡· ARG</button>
        </div>
        <button class="start-btn" id="sBtn" style="display:none;" onclick="startGame()">POÄŒNI IGRAJU</button>
    </div>
    
    <div id="ui">
        <div>ZEMLJA: <span id="user-flag">-</span></div>
        <div>TIM: <span id="team-count">1</span></div>
        <div>SCORE: <span id="dist">0</span>m</div>
    </div>

    <script src="https://unpkg.com/three@0.128.0/build/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, isRunning = false;
        let targetX = 0, distance = 0, speed = 0.3, selectedFlag = "";
        let obstacles = [], legends = [], team = [];

        function setFlag(flag) {
            selectedFlag = flag;
            document.getElementById('user-flag').innerText = flag;
            document.getElementById('sBtn').style.display = 'block';
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x27ae60);
            scene.fog = new THREE.Fog(0x27ae60, 15, 65);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 6, 12);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            let sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(5, 15, 10);
            scene.add(sun);

            const ground = new THREE.Mesh(new THREE.PlaneGeometry(20, 10000), new THREE.MeshPhongMaterial({color: 0x2ecc71}));
            ground.rotation.x = -Math.PI/2;
            scene.add(ground);

            player = createCharacter(0xffff00); 
            scene.add(player);
            team.push(player);

            window.addEventListener('touchmove', (e) => {
                targetX = (e.touches[0].clientX / window.innerWidth - 0.5) * 12;
            });

            for(let i=1; i<15; i++) {
                spawnObstacle(-i * 40);
                if(i % 4 === 0) spawnLegend(-i * 50);
            }
            animate();
        }

        function createCharacter(color) {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 0.8), new THREE.MeshPhongMaterial({color: color}));
            body.position.y = 1;
            group.add(body);
            const ball = new THREE.Mesh(new THREE.SphereGeometry(0.25), new THREE.MeshPhongMaterial({color: 0xffffff}));
            ball.position.set(0, 0.2, -0.7);
            group.add(ball);
            return group;
        }

        function spawnObstacle(z) {
            const obs = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshPhongMaterial({color: 0x333333}));
            obs.position.set(Math.random()*10-5, 1, z);
            scene.add(obs);
            obstacles.push(obs);
        }

        function spawnLegend(z) {
            const leg = createCharacter(0xffffff);
            leg.position.set(Math.random()*8-4, 0, z);
            // Dodaj kavez (providna plava kocka)
            const cage = new THREE.Mesh(new THREE.BoxGeometry(2.5, 3, 2.5), new THREE.MeshPhongMaterial({color: 0x00aaff, transparent: true, opacity: 0.3}));
            cage.position.y = 1.5;
            leg.add(cage);
            scene.add(leg);
            legends.push(leg);
        }

        function startGame() {
            isRunning = true;
            document.getElementById('menu').style.display = 'none';
            document.getElementById('ui').style.display = 'flex';
        }

        function animate() {
            requestAnimationFrame(animate);
            if(isRunning) {
                player.position.z -= speed;
                player.position.x += (targetX - player.position.x) * 0.12;
                distance += speed;
                document.getElementById('dist').innerText = Math.floor(distance);

                for(let i=1; i<team.length; i++) {
                    team[i].position.z = player.position.z + (i * 1.8);
                    team[i].position.x += (team[i-1].position.x - team[i].position.x) * 0.15;
                }

                camera.position.z = player.position.z + 10;
                camera.lookAt(player.position.x, 1, player.position.z - 5);

                obstacles.forEach((obs) => {
                    if(player.position.distanceTo(obs.position) < 1.6) {
                        isRunning = false;
                        alert("GAME OVER! Spasio si " + (team.length-1) + " legendi za " + selectedFlag);
                        location.reload();
                    }
                    if(obs.position.z > player.position.z + 10) {
                        obs.position.z = player.position.z - 200;
                        obs.position.x = Math.random()*10-5;
                    }
                });

                legends.forEach((leg, i) => {
                    if(player.position.distanceTo(leg.position) < 2) {
                        // Ukloni kavez (poslednji dodat objekat u grupi legende)
                        leg.remove(leg.children[2]); 
                        team.push(leg);
                        legends.splice(i, 1);
                        document.getElementById('team-count').innerText = team.length;
                        speed += 0.015;
                    }
                });
            }
            renderer.render(scene, camera);
        }
        init();
    </script>
</body>
</html>
