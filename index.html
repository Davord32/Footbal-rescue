<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #27ae60; touch-action: none; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; color: white; font-weight: bold; text-shadow: 2px 2px black; z-index: 10; }
        #msg { position: absolute; top: 50%; width: 100%; text-align: center; color: white; font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="ui">
        <div>TIM: <span id="tc">1</span></div>
        <div>SCORE: <span id="sc">0</span></div>
    </div>
    <div id="msg">DODIRNI EKRAN DA KRENEÅ !</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, player, active = false;
        let score = 0, obstacles = [], speed = 0.4;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x27ae60);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(0, 10, 10);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));

            // Igrac (Lopta)
            const geo = new THREE.SphereGeometry(0.5, 16, 16);
            const mat = new THREE.MeshPhongMaterial({color: 0xffffff});
            player = new THREE.Mesh(geo, mat);
            player.position.y = 0.5;
            scene.add(player);

            // Podloga
            const gGeo = new THREE.PlaneGeometry(20, 1000);
            const gMat = new THREE.MeshPhongMaterial({color: 0x2ecc71});
            const ground = new THREE.Mesh(gGeo, gMat);
            ground.rotation.x = -Math.PI/2;
            scene.add(ground);

            // Generisanje prepreka odmah
            for(let i=0; i<10; i++) spawnObs(-i * 30 - 20);

            window.addEventListener('touchstart', () => { 
                active = true; 
                document.getElementById('msg').style.display = 'none';
            });
            
            window.addEventListener('touchmove', (e) => {
                let touch = e.touches[0];
                let x = (touch.clientX / window.innerWidth) * 2 - 1;
                player.position.x = x * 5;
            });

            animate();
        }

        function spawnObs(z) {
            const oGeo = new THREE.BoxGeometry(2, 2, 2);
            const oMat = new THREE.MeshPhongMaterial({color: 0xff0000});
            const obs = new THREE.Mesh(oGeo, oMat);
            obs.position.set(Math.random()*8-4, 1, z);
            scene.add(obs);
            obstacles.push(obs);
        }

        function animate() {
            requestAnimationFrame(animate);
            if(active) {
                player.position.z -= speed;
                camera.position.z = player.position.z + 10;
                score++;
                document.getElementById('sc').innerText = Math.floor(score/10);

                obstacles.forEach(o => {
                    if(o.position.distanceTo(player.position) < 1.5) {
                        active = false;
                        alert("KRAJ! Rezultat: " + Math.floor(score/10));
                        location.reload();
                    }
                    if(o.position.z > player.position.z + 10) {
                        o.position.z -= 200;
                        o.position.x = Math.random()*8-4;
                    }
                });
            }
            renderer.render(scene, camera);
        }
        init();
    </script>
</body>
</html>
